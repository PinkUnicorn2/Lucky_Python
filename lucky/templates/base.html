<!DOCTYPE html>
<html>
 <head>
	<title>Pyluck</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="static/bootstrap.min.css" rel="stylesheet" media="screen">
	<script type="text/javascript" src="static/socket.io.js"></script>
	<script src="static/jquery.js"></script>
 </head>

 <body>
	<div class="container">

	 {% block content %}{% endblock %}

 	 {% if current_user.is_authenticated %}
		         <h2>Angemeldet als : {{ current_user.username }}</h2>
		         <p><a href="{{ url_for('.logout') }}">Logout</a></p>
		{% else %}
		         <p><a href="{{ url_for('.login') }}">Login</a></p>
		         <p><a href="{{ url_for('.register') }}">Registrierung</a></p>
	 {% endif %}

	 {% if error %}
	   <p class="error"><strong>Error:</strong> {{ error }}</p>
	 {% endif %}
         
         {% for message in get_flashed_messages() %}
	      <div class="alert alert-danger alert-dismissible" role="alert">
	 {{ message }}
         {% endfor %}

     </div>
	</div>

	 <script type="text/javascript">
		$(document).ready(function() {

		var socket = io.connect('http://127.0.0.1:5000');

		socket.on('message', function(msg) {
			$("#messages").append('<li>'+msg+'</li>');
		});
		$('#sendbutton').on('click', function() {
			socket.send($('#myMessage').val());
			$('#myMessage').val('');
		});

	 });
	 </script>
	 <ul id="messages">
		 {% for msg in messages %}
		 	<li>{{ msg.message }}</li>
		 {% endfor %}
	 </ul>
	{% if current_user.is_authenticated %}
	 <input type="text" id="myMessage">
	 <button id="sendbutton">Send</button>
 	{% endif %}
 </body>
</html>
